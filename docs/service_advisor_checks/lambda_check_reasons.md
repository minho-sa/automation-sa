# Lambda 서비스 어드바이저 검사항목 분석

## 개요
Lambda 서비스 어드바이저는 AWS Lambda 함수의 성능, 비용, 보안을 최적화하기 위한 포괄적인 검사를 수행합니다. 서버리스 아키텍처의 특성을 고려한 맞춤형 분석을 제공합니다.

## 검사항목 목록

### 1. 메모리 크기 최적화 검사 (lambda-memory-size)

#### 검사 목적
- **주요 목적**: CloudWatch 메트릭 분석을 통한 메모리 할당 최적화
- **비용 효율성**: 과다/과소 프로비저닝된 메모리로 인한 비용 낭비 방지

#### 심각도 기준: MEDIUM
**MEDIUM으로 설정한 이유:**
1. **비용 영향**: Lambda는 메모리 크기에 따라 비용이 결정되어 직접적인 비용 영향
2. **성능 연관성**: 메모리 크기는 CPU 할당량과 직결되어 성능에 중요한 영향
3. **점진적 개선**: 즉시 해결하지 않아도 서비스 중단은 없음
4. **측정 가능성**: 정량적 지표로 개선 효과를 명확히 측정 가능

#### 검사 기준
- **FAIL 조건**:
  - 평균 메모리 사용률 < 20% AND 최대 메모리 사용률 < 50% (과다 프로비저닝)
  - 최대 메모리 사용률 > 90% (과소 프로비저닝)
- **PASS 조건**: 메모리 사용률이 적절한 범위 내 (20-90%)
- **UNKNOWN 조건**: 충분한 CloudWatch 메트릭 데이터가 없는 경우
- **분석 기간**: 최근 14일간의 CloudWatch 메트릭 데이터 (1시간 간격)
- **메트릭**: MemoryUtilization

#### 권장 개선 방안
1. **점진적 조정**: 25% 단위로 메모리 크기 조정
2. **성능 테스트**: 메모리 변경 후 성능 영향 측정
3. **비용 분석**: 메모리 변경에 따른 비용 절감 효과 계산
4. **모니터링 강화**: 메모리 사용률 지속적 모니터링

---

### 2. 타임아웃 설정 최적화 검사 (lambda-timeout)

#### 검사 목적
- **주요 목적**: 함수 실행 시간과 타임아웃 설정의 균형 최적화
- **안정성 확보**: 적절한 타임아웃으로 함수 실행 안정성 보장

#### 심각도 기준: MEDIUM
**MEDIUM으로 설정한 이유:**
1. **실행 안정성**: 타임아웃이 너무 짧으면 함수가 중간에 종료될 위험
2. **비용 최적화**: 과도한 타임아웃은 오류 발생 시 불필요한 대기 시간 발생
3. **사용자 경험**: 적절한 타임아웃은 응답 시간 예측 가능성 향상
4. **운영 효율성**: 적정 타임아웃으로 리소스 사용 효율성 개선

#### 검사 기준
- **FAIL 조건**:
  - 최대 실행 시간이 타임아웃의 80% 이상 (위험)
  - 최대 실행 시간이 타임아웃의 10% 미만이고 타임아웃 > 10초 (과도한 설정)
- **PASS 조건**: 실행 시간과 타임아웃이 적절한 비율
- **UNKNOWN 조건**: 충분한 CloudWatch 메트릭 데이터가 없는 경우
- **분석 기간**: 최근 14일간의 Duration 메트릭 (1시간 간격)
- **계산 방식**: max_duration_ratio = (max_duration / timeout_ms) * 100

#### 권장 개선 방안
1. **실행 시간 분석**: 평균 및 최대 실행 시간 기반 타임아웃 설정
2. **안전 마진 확보**: 최대 실행 시간의 120-150% 수준으로 타임아웃 설정
3. **코드 최적화**: 실행 시간이 긴 함수의 성능 개선
4. **에러 핸들링**: 타임아웃 발생 시 적절한 에러 처리 구현

---

### 3. 런타임 버전 최적화 검사 (lambda-runtime)

#### 검사 목적
- **주요 목적**: 최신 런타임 버전 사용을 통한 보안 및 성능 향상
- **보안 강화**: 지원 종료된 런타임의 보안 취약점 해결

#### 심각도 기준: HIGH
**HIGH로 설정한 이유:**
1. **보안 위험**: 지원 종료된 런타임은 보안 패치를 받지 못함
2. **서비스 중단 위험**: AWS에서 런타임 지원 중단 시 함수 실행 불가
3. **규제 준수**: 최신 보안 표준 준수를 위한 런타임 업데이트 필요
4. **장기적 영향**: 런타임 업데이트 지연 시 기술 부채 누적

#### 검사 기준
- **FAIL 조건**:
  - 지원 종료된 런타임 사용 (nodejs10.x, nodejs8.10, nodejs6.10, nodejs4.3, python2.7, python3.6, ruby2.5, dotnetcore2.1, dotnetcore1.0, java8)
  - 최신 버전이 아닌 런타임 사용
- **PASS 조건**: 최신 런타임 버전 사용
- **권장 런타임**: 
  - Node.js: nodejs18.x
  - Python: python3.10
  - Ruby: ruby3.2
  - Java: java17
  - .NET: dotnet6
  - Go: go1.x

#### 권장 개선 방안
1. **단계적 업그레이드**: 개발 → 스테이징 → 프로덕션 순서로 업그레이드
2. **호환성 테스트**: 런타임 변경 후 철저한 기능 테스트
3. **의존성 검토**: 새 런타임과 라이브러리 호환성 확인
4. **롤백 계획**: 문제 발생 시 이전 버전으로 롤백 계획 수립

---

### 4. 태그 관리 검사 (lambda-tags)

#### 검사 목적
- **주요 목적**: 리소스 관리 및 비용 할당을 위한 태그 표준화
- **거버넌스**: 조직의 리소스 관리 정책 준수

#### 심각도 기준: LOW
**LOW로 설정한 이유:**
1. **운영 효율성**: 직접적인 보안이나 성능 위험은 없음
2. **관리 편의성**: 태그 부족이 즉시 서비스에 영향을 주지 않음
3. **점진적 개선**: 시간을 두고 천천히 개선 가능
4. **조직별 차이**: 조직마다 태그 정책이 다를 수 있음

#### 검사 기준
- **FAIL 조건**:
  - 태그가 전혀 없는 함수
  - 필수 태그 누락 (Environment, Project, Owner, CostCenter)
- **PASS 조건**: 모든 권장 태그가 설정됨
- **권장 태그**: Environment, Project, Owner, CostCenter

#### 권장 개선 방안
1. **태그 정책 수립**: 조직 차원의 태그 표준 정의
2. **자동화**: Infrastructure as Code를 통한 태그 자동 적용
3. **정기적 검토**: 분기별 태그 준수 상태 검토
4. **비용 분석**: 태그 기반 비용 분석 및 최적화

---

### 5. 프로비저닝된 동시성 최적화 검사 (lambda-provisioned-concurrency)

#### 검사 목적
- **주요 목적**: 콜드 스타트 지연 시간 최소화와 비용 효율성의 균형
- **성능 최적화**: 지연 시간에 민감한 애플리케이션의 성능 향상

#### 심각도 기준: MEDIUM
**MEDIUM으로 설정한 이유:**
1. **성능 영향**: 콜드 스타트는 사용자 경험에 직접적 영향
2. **비용 영향**: 프로비저닝된 동시성은 상당한 추가 비용 발생
3. **워크로드 의존성**: 애플리케이션 특성에 따라 필요성이 다름
4. **최적화 복잡성**: 호출 패턴 분석을 통한 정교한 설정 필요

#### 검사 기준
- **FAIL 조건**:
  - 시간당 평균 호출 수 > 10회이지만 프로비저닝된 동시성 미설정
  - 시간당 평균 호출 수 < 5회이지만 프로비저닝된 동시성 설정됨
- **PASS 조건**: 호출 패턴에 맞는 적절한 프로비저닝된 동시성 설정
- **UNKNOWN 조건**: 충분한 CloudWatch 메트릭 데이터가 없는 경우
- **분석 기간**: 최근 14일간의 Invocations 메트릭
- **임계값**: 호출 빈도와 지연 시간 요구사항 기반

#### 권장 개선 방안
1. **호출 패턴 분석**: 시간대별, 요일별 호출 패턴 분석
2. **비용 대비 효과**: 프로비저닝 비용 vs 성능 개선 효과 분석
3. **점진적 적용**: 중요한 함수부터 단계적으로 적용
4. **모니터링**: 콜드 스타트 빈도 및 지연 시간 지속 모니터링

---

### 6. 코드 서명 구성 검사 (lambda-code-signing)

#### 검사 목적
- **주요 목적**: 배포된 코드의 무결성과 출처 보장
- **보안 강화**: 승인되지 않은 코드 배포 방지

#### 심각도 기준: MEDIUM
**MEDIUM으로 설정한 이유:**
1. **보안 중요성**: 코드 무결성은 중요하지만 모든 환경에 필수는 아님
2. **환경별 차이**: 프로덕션 환경에서는 중요하지만 개발 환경에서는 선택적
3. **구현 복잡성**: 코드 서명 인프라 구축에 상당한 노력 필요
4. **점진적 도입**: 조직의 보안 성숙도에 따라 단계적 도입 가능

#### 검사 기준
- **FAIL 조건**: 프로덕션 환경 함수에 코드 서명 미구성
- **PASS 조건**: 프로덕션 환경 함수에 코드 서명 구성됨 또는 비프로덕션 환경
- **환경 식별**: Environment 태그를 통한 프로덕션 환경 식별 (prod, production)
- **서명 정책**: AWS Signer를 통한 코드 서명 구성 확인

#### 권장 개선 방안
1. **서명 정책 수립**: 코드 서명이 필요한 환경 및 함수 정의
2. **CI/CD 통합**: 배포 파이프라인에 코드 서명 프로세스 통합
3. **키 관리**: 서명 키의 안전한 관리 및 순환 정책 수립
4. **모니터링**: 서명되지 않은 코드 배포 시도 감지 및 알림

---

### 7. 최소 권한 원칙 준수 검사 (lambda-least-privilege)

#### 검사 목적
- **주요 목적**: Lambda 함수 실행 역할의 과도한 권한 제거
- **보안 강화**: 함수 침해 시 피해 범위 최소화

#### 심각도 기준: HIGH
**HIGH로 설정한 이유:**
1. **보안 위험**: 과도한 권한은 함수 침해 시 큰 피해 초래
2. **연쇄 공격**: 높은 권한의 함수는 다른 리소스 공격의 발판
3. **규제 요구사항**: 최소 권한 원칙은 보안 표준의 핵심 요소
4. **예방 효과**: 권한 제한을 통한 예방적 보안 조치

#### 검사 기준
- **FAIL 조건**:
  - AdministratorAccess 정책 연결
  - PowerUserAccess 정책 연결
  - 과도하게 넓은 권한을 가진 관리형 정책 사용 (AmazonS3FullAccess, AmazonDynamoDBFullAccess 등)
- **PASS 조건**: 최소 권한 원칙을 따르는 적절한 권한 설정
- **분석 대상**: Lambda 실행 역할에 연결된 모든 정책

#### 권장 개선 방안
1. **권한 분석**: 함수가 실제로 사용하는 AWS 서비스 및 작업 식별
2. **커스텀 정책**: 필요한 권한만 포함하는 사용자 정의 정책 생성
3. **정기적 검토**: 분기별 권한 사용 현황 검토 및 불필요한 권한 제거
4. **Access Analyzer**: AWS IAM Access Analyzer를 통한 권한 분석

## 검사 항목별 심각도 분포

### 총 검사 항목: 7개

### HIGH (높음) - 즉시 조치 필요 (2개)
- 런타임 버전 최적화 검사
- 최소 권한 원칙 준수 검사

### MEDIUM (중간) - 계획적 개선 필요 (4개)
- 메모리 크기 최적화 검사
- 타임아웃 설정 최적화 검사
- 프로비저닝된 동시성 최적화 검사
- 코드 서명 구성 검사

### LOW (낮음) - 점진적 개선 권장 (1개)
- 태그 관리 검사