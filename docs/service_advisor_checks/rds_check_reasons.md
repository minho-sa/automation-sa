# RDS 서비스 어드바이저 검사항목 분석

## 개요
RDS 서비스 어드바이저는 Amazon RDS 데이터베이스 인스턴스의 가용성, 보안, 성능, 비용을 최적화하기 위한 검사를 수행합니다. 데이터베이스의 중요성을 고려한 포괄적인 분석을 제공합니다.

## 검사항목 목록

### 1. 백업 보존 기간 (rds-backup-retention)

#### 검사 목적
- **주요 목적**: 데이터 손실 방지를 위한 적절한 백업 정책 확인
- **데이터 보호**: 하드웨어 장애, 인적 오류, 악의적 행위로부터 데이터 보호
- **복구 능력**: 특정 시점으로의 데이터 복구 가능성 보장

#### 심각도 기준: HIGH
**HIGH로 설정한 이유:**
1. **데이터 중요성**: 데이터베이스는 비즈니스의 핵심 자산으로 손실 시 치명적 영향
2. **복구 불가능성**: 백업 없이 데이터 손실 시 완전한 복구가 불가능
3. **규제 요구사항**: 대부분의 산업에서 데이터 백업을 법적으로 요구
4. **비즈니스 연속성**: 백업은 재해 복구 계획의 핵심 요소

#### 검사 기준
- **FAIL 조건**: 백업 보존 기간 < 1일 (자동 백업 비활성화)
- **WARNING 조건**: 백업 보존 기간 < 7일
- **PASS 조건**: 백업 보존 기간 >= 7일
- **권장 기준**: 최소 7일 (recommended_retention = 7)
- **분석 대상**: 모든 RDS 인스턴스의 BackupRetentionPeriod 설정

#### 권장 개선 방안
1. **최소 보존 기간**: 프로덕션 DB는 최소 7일 이상 설정
2. **장기 백업**: 중요한 데이터는 스냅샷을 통한 장기 보존
3. **백업 테스트**: 정기적인 백업 복원 테스트 수행
4. **자동화**: 백업 정책의 자동 적용 및 모니터링

---

### 2. 다중 AZ 구성 (rds-multi-az)

#### 검사 목적
- **주요 목적**: 데이터베이스 고가용성 확보
- **장애 대응**: 하드웨어 장애, AZ 장애 시 자동 장애 조치
- **유지 관리**: 계획된 유지 관리 중 서비스 가용성 유지

#### 심각도 기준: MEDIUM
**MEDIUM으로 설정한 이유:**
1. **가용성 중요성**: 서비스 중단은 비즈니스에 영향을 주지만 데이터 손실만큼 치명적이지 않음
2. **비용 고려**: 다중 AZ는 추가 비용이 발생하여 모든 환경에 필수는 아님
3. **환경별 차이**: 개발/테스트 환경에서는 선택적으로 적용 가능
4. **대안 존재**: 읽기 전용 복제본 등 다른 고가용성 방법 존재

#### 검사 기준
- **FAIL 조건**: 프로덕션 환경 인스턴스의 MultiAZ가 false
- **WARNING 조건**: 일반 환경 인스턴스의 MultiAZ가 false
- **PASS 조건**: MultiAZ가 true인 경우
- **환경 식별**: 
  - 태그: Environment 키가 'prod', 'production', 'prd' 포함
  - 인스턴스명: 'prod', 'production', 'prd' 포함
- **분석 대상**: 모든 RDS 인스턴스의 MultiAZ 설정

#### 권장 개선 방안
1. **프로덕션 필수**: 모든 프로덕션 데이터베이스에 다중 AZ 구성
2. **비용 분석**: 다중 AZ 비용 vs 다운타임 비용 분석
3. **테스트**: 장애 조치 시나리오 테스트 수행
4. **모니터링**: 장애 조치 이벤트 모니터링 및 알림 설정

---

### 3. 암호화 설정 (rds-encryption)

#### 검사 목적
- **주요 목적**: 저장 데이터의 암호화를 통한 데이터 보호
- **규제 준수**: 개인정보보호법, GDPR 등 규제 요구사항 충족
- **보안 강화**: 물리적 미디어 도난 시 데이터 보호

#### 심각도 기준: HIGH
**HIGH로 설정한 이유:**
1. **데이터 보안**: 암호화되지 않은 데이터는 물리적 접근 시 노출 위험
2. **규제 요구사항**: 대부분의 데이터 보호 규정에서 암호화 필수
3. **민감 정보**: 데이터베이스는 일반적으로 민감한 정보 포함
4. **복구 불가능**: 암호화 없이 데이터 유출 시 되돌릴 수 없음

#### 검사 기준
- **FAIL 조건**: 프로덕션 환경 인스턴스의 StorageEncrypted가 false
- **WARNING 조건**: 일반 환경 인스턴스의 StorageEncrypted가 false
- **PASS 조건**: StorageEncrypted가 true인 경우
- **환경 식별**: 
  - 태그: environment/env가 'prod'/'production'
  - 인스턴스명: 'prod-', 'production-' 시작하거나 'prod' 포함
- **분석 대상**: 모든 RDS 인스턴스의 StorageEncrypted 설정

#### 권장 개선 방안
1. **기본 암호화**: 모든 새 인스턴스에 암호화 기본 적용
2. **키 관리**: AWS KMS를 통한 암호화 키 관리
3. **마이그레이션**: 기존 암호화되지 않은 인스턴스의 암호화 마이그레이션
4. **성능 테스트**: 암호화 적용 후 성능 영향 측정

---

### 4. 공개 액세스 설정 (rds-public-access)

#### 검사 목적
- **주요 목적**: 데이터베이스의 인터넷 노출 방지
- **보안 강화**: 무차별 대입 공격 및 취약점 스캐닝 방지
- **네트워크 보안**: VPC 내부 통신을 통한 보안 강화

#### 심각도 기준: HIGH
**HIGH로 설정한 이유:**
1. **직접적 위험**: 인터넷에 노출된 데이터베이스는 즉각적인 공격 대상
2. **공격 빈도**: 공개 데이터베이스는 자동화된 공격 도구의 주요 타겟
3. **데이터 유출**: 성공적인 공격 시 전체 데이터베이스 내용 유출 가능
4. **방어 어려움**: 인터넷 전체에서 오는 공격을 모두 차단하기 어려움

#### 검사 기준
- **FAIL 조건**: PubliclyAccessible = true로 설정된 모든 인스턴스
- **예외 없음**: 모든 데이터베이스는 VPC 내부에서만 접근 가능해야 함
- **분석 대상**: 모든 RDS 인스턴스의 PubliclyAccessible 설정

#### 권장 개선 방안
1. **VPC 구성**: 모든 데이터베이스를 VPC 내부에 배치
2. **프라이빗 서브넷**: 데이터베이스 전용 프라이빗 서브넷 구성
3. **접근 제어**: 보안 그룹을 통한 세밀한 접근 제어
4. **VPN/Direct Connect**: 외부 접근이 필요한 경우 안전한 연결 방법 사용

---

### 5. 인스턴스 크기 최적화 (rds-instance-sizing)

#### 검사 목적
- **주요 목적**: CloudWatch 메트릭 분석을 통한 인스턴스 크기 최적화
- **비용 효율성**: 과다/과소 프로비저닝된 인스턴스 식별
- **성능 최적화**: 워크로드에 적합한 인스턴스 크기 권장

#### 심각도 기준: MEDIUM
**MEDIUM으로 설정한 이유:**
1. **비용 영향**: 데이터베이스 인스턴스는 상당한 비용을 차지
2. **성능 영향**: 부적절한 크기는 애플리케이션 성능에 직접 영향
3. **점진적 개선**: 즉시 해결하지 않아도 서비스 중단은 없음
4. **복잡성**: 데이터베이스 크기 조정은 신중한 계획과 테스트 필요

#### 검사 기준
- **FAIL 조건**:
  - 평균 CPU 사용률 < 5% AND 최대 CPU 사용률 < 20% (과다 프로비저닝)
  - 평균 CPU 사용률 > 70% OR 최대 CPU 사용률 > 90% (과소 프로비저닝)
- **분석 기간**: 최근 14일간의 CloudWatch 메트릭 데이터
- **추가 메트릭**: 메모리 사용률, 디스크 I/O, 네트워크 사용률

#### 권장 개선 방안
1. **성능 분석**: CPU, 메모리, I/O 등 종합적 성능 지표 분석
2. **점진적 조정**: 단계적 인스턴스 크기 조정 및 성능 모니터링
3. **예약 인스턴스**: 안정적인 워크로드에 대한 비용 절감
4. **읽기 전용 복제본**: 읽기 워크로드 분산을 통한 성능 개선

## 검사 실행 프로세스

### 데이터 수집
1. **인스턴스 정보**: describe_db_instances API를 통한 모든 RDS 인스턴스 정보
2. **CloudWatch 메트릭**: CPU, 메모리, 디스크, 네트워크 사용률 데이터
3. **태그 정보**: list_tags_for_resource API를 통한 인스턴스별 태그
4. **보안 설정**: 암호화, 공개 액세스, 백업 설정 등

### 분석 알고리즘
1. **메트릭 기반 분석**: 14일간의 CloudWatch 데이터 통계 분석
2. **환경 분류**: 태그 및 명명 규칙을 통한 프로덕션/개발 환경 구분
3. **위험도 평가**: 보안 설정의 위험도 점수 계산
4. **비용 영향 분석**: 최적화를 통한 예상 비용 절감액 산출

### 결과 생성
- **인스턴스별 권장사항**: 각 인스턴스에 특화된 개선 방안 제시
- **우선순위**: 보안 위험도 및 비용 영향도 기반 우선순위
- **구현 계획**: 단계별 개선 작업 계획 제공

## 모니터링 및 개선

### 지속적 모니터링
- **백업 상태**: 백업 성공/실패 모니터링
- **성능 추적**: 인스턴스 크기 조정 후 성능 변화 추적
- **보안 이벤트**: 보안 설정 변경 및 접근 시도 모니터링
- **비용 분석**: 월간 비용 변화 및 최적화 효과 측정

### 성공 지표
- **가용성 향상**: 다중 AZ 구성을 통한 가용성 개선
- **보안 강화**: 암호화 및 네트워크 보안 설정 개선
- **비용 최적화**: 인스턴스 크기 최적화를 통한 비용 절감
- **데이터 보호**: 백업 정책 준수를 통한 데이터 보호 강화

## 데이터베이스 엔진별 고려사항

### MySQL/MariaDB
- **InnoDB 버퍼 풀**: 메모리 사용률 분석 시 InnoDB 설정 고려
- **슬로우 쿼리**: 성능 최적화를 위한 슬로우 쿼리 로그 분석
- **복제 지연**: 읽기 전용 복제본의 복제 지연 모니터링

### PostgreSQL
- **공유 버퍼**: 메모리 설정 최적화
- **WAL 설정**: 백업 및 복제 성능에 영향을 주는 WAL 설정
- **확장 기능**: PostgreSQL 확장 기능 사용에 따른 리소스 요구사항

### Oracle
- **SGA/PGA**: Oracle 메모리 구조에 따른 인스턴스 크기 최적화
- **라이선스**: Oracle 라이선스 비용을 고려한 인스턴스 크기 결정
- **백업 전략**: Oracle RMAN과 RDS 백업의 통합 전략

### SQL Server
- **메모리 관리**: SQL Server 메모리 사용 패턴 분석
- **라이선스 최적화**: SQL Server 라이선스 비용 최적화
- **Always On**: 고가용성을 위한 Always On 가용성 그룹 고려

## 관련 AWS 서비스

### 모니터링 및 관리
- **Amazon CloudWatch**: 데이터베이스 성능 메트릭 모니터링
- **AWS Performance Insights**: 데이터베이스 성능 분석 및 튜닝
- **AWS Config**: 데이터베이스 구성 변경 추적 및 규정 준수

### 보안 강화
- **AWS KMS**: 데이터베이스 암호화 키 관리
- **AWS Secrets Manager**: 데이터베이스 자격 증명 안전한 관리
- **VPC**: 네트워크 수준 보안 및 격리

### 백업 및 복구
- **AWS Backup**: 중앙 집중식 백업 관리
- **Amazon S3**: 장기 백업 보관
- **AWS Database Migration Service**: 데이터베이스 마이그레이션 및 복제

### 비용 최적화
- **AWS Cost Explorer**: 데이터베이스 비용 분석
- **Reserved Instances**: 예약 인스턴스를 통한 비용 절감
- **AWS Trusted Advisor**: 추가적인 비용 최적화 권장사항

## 재해 복구 계획

### 백업 전략
1. **자동 백업**: 일일 자동 백업 활성화
2. **스냅샷**: 주요 변경 전 수동 스냅샷 생성
3. **크로스 리전**: 중요한 데이터의 다른 리전 백업
4. **보존 정책**: 비즈니스 요구사항에 맞는 백업 보존 기간 설정

### 복구 절차
1. **RTO/RPO 정의**: 복구 시간 목표 및 복구 지점 목표 설정
2. **복구 테스트**: 정기적인 백업 복원 테스트 수행
3. **문서화**: 상세한 복구 절차 문서화 및 업데이트
4. **훈련**: 운영팀의 복구 절차 훈련 및 시뮬레이션

## 검사 항목 요약

### 총 검사 항목: 5개

### HIGH (높음) - 즉시 조치 필요 (3개)
- 백업 보존 기간
- 암호화 설정
- 공개 액세스 설정

### MEDIUM (중간) - 계획적 개선 필요 (2개)
- 다중 AZ 구성
- 인스턴스 크기 최적화

이 문서는 RDS 서비스 어드바이저의 각 검사항목이 데이터베이스 환경에서 왜 중요한지, 어떤 기준으로 심각도를 설정했는지에 대한 상세한 분석을 제공합니다.